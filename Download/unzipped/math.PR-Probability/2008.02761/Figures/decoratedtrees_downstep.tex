\begin{tikzpicture}[
    bp/.style={rectangle, fill, inner sep=0pt, minimum width=2pt, minimum height=2pt},
    comment/.style={circle, draw, color=orange},
    leaf/.style={inner sep=1pt},
    weights/.style={auto, swap, orange, inner sep = 1pt},
    label/.style={text=oxfordblue},
    line/.style={-, line width = 2pt, color = oxfordblue},
    arrowline/.style={->, line width = 1pt, color = oxfordblue, >=stealth},
    scale=1
  ]
  \tikzstyle{every node}=[font=\tiny]

  %
  % Semi-planar version
  %

  \begin{scope}[xscale = -0.6, yscale = 0.8]

    \node (0) at (0,0) {};

    \node[bp] (bp_1) at (0,1) {};
    \node[bp] (bp_2) at (1,1) {};
    \node[leaf] (4) at (0.5,2.1) {$4$};

    \node[bp] (v_1) at (1.8,2) {};
    \node[bp] (v_2) at (3,2) {};
    \node[bp] (v_3) at (4,2) {};
    \node[bp] (v_4) at (6.5,2) {};

  % 1 subtree (from left) (v_1)
    \node[bp] (bp2_1) at (4,3) {};
    \node[bp] (bp2_2) at (5,3) {};
    \node[leaf] (8) at (4.5, 4) {$8$};
    \node[leaf] (6) at (5.5, 4) {$b = 6$};

  % 2 subtree (from left) (v_2)
    \node[leaf] (3) at (3,3) {$i = 3$};

  % 3 subtree (from left) (v_3)
    \node[bp] (bp3_1) at (5.8,3) {};
    \node[bp] (bp3_2) at (6.7,3) {};
    \node[bp] (bp3_3) at (7.5,3) {};
    \node[leaf] (7) at (6.7, 4) {$7$};
    \node[leaf] (5) at (7, 4) {$5$};
    \node[leaf] (2) at (8, 4) {$2$};

  % 4 subtree (from left)
    \node[leaf] (1) at (7,2.7) {$a = 1$};

    \draw[line] (0) to (bp_1);
    \draw[line] (bp_2.center) to (4);

    \draw[line] (bp_2.center) to (v_1.center);
    \draw[line] (v_2.center) to (3);
    \draw[line] (bp2_2.center) to (8);
    \draw[line] (bp2_2.center) to (6);

    \draw[line] (v_3.center) to (bp2_1.center);

    \draw[line] (v_4.center) to (bp3_1.center);
    \draw[line] (bp3_2.center) to (7);
    \draw[line] (bp3_3.center) to (5);
    \draw[line] (bp3_3.center) to (2);

    \draw[line] (v_4.center) to (1);

    \draw[line, orange] (bp_1.east) to (bp_2.west);
    \draw[line, orange] (v_1.east) to (v_2) to (v_3) to (v_4.west);
    \draw[line, orange] (bp2_1.east) to (bp2_2.west);
    \draw[line, orange] (bp3_1.east) to (bp3_2) to (bp3_3.west);
  \end{scope}
  
  %
  % Semi-planar version after down-step
  %

  \begin{scope}[shift = {(7.2,0)}, xscale = -0.6, yscale = 0.8]

    \node (0) at (0,0) {};

    \node[bp] (bp_1) at (0,1) {};
    \node[bp] (bp_2) at (1,1) {};
    \node[leaf] (3) at (0.5,2.1) {$4$};

    \node[bp] (v_1) at (1.8,2) {};
    \node[bp] (v_2) at (3,2) {};
    \node[bp] (v_3) at (5.5,2) {};

  % 1 subtree (from left) (v_1)
    \node[bp] (bp2_1) at (3,3) {};
    \node[bp] (bp2_2) at (4,3) {};
    \node[leaf] (8) at (3.5, 4) {$7$};
    \node[leaf] (6) at (4.5, 4) {$3$};

  % 2 subtree (from left) (v_3)
    \node[bp] (bp3_1) at (4.8,3) {};
    \node[bp] (bp3_2) at (5.7,3) {};
    \node[bp] (bp3_3) at (6.5,3) {};
    \node[leaf] (7) at (5.7, 4) {$6$};
    \node[leaf] (5) at (6, 4) {$5$};
    \node[leaf] (2) at (7, 4) {$2$};

  % 4 subtree (from left)
    \node[leaf] (1) at (6,2.7) {$1$};

    \draw[line] (0) to (bp_1);
    \draw[line] (bp_2.center) to (3);

    \draw[line] (bp_2.center) to (v_1.center);
    \draw[line] (bp2_2.center) to (8);
    \draw[line] (bp2_2.center) to (6);

    \draw[line] (v_2.center) to (bp2_1.center);

    \draw[line] (v_3.center) to (bp3_1.center);
    \draw[line] (bp3_2.center) to (7);
    \draw[line] (bp3_3.center) to (5);
    \draw[line] (bp3_3.center) to (2);

    \draw[line] (v_3.center) to (1);

    \draw[line, orange] (bp_1.east) to (bp_2.west);
    \draw[line, orange] (v_1.east) to (v_2) to (v_3);
    \draw[line, orange] (bp2_1.east) to (bp2_2.west);
    \draw[line, orange] (bp3_1.east) to (bp3_2) to (bp3_3.west);
  \end{scope}

  %
  % First decorated tree
  %

  \begin{scope}[shift = {(-2,-4)}]
    %
    \node (0) at (0,0) {};
    \node (v) at (0,1) {};
    \node[leaf] (1) at (-1,2) {$1$};
    \node[leaf, anchor = south] (2) at (0, 2) {$2$};
    \node[leaf] (3) at (1, 2) {$3$};

    \draw[line] (0.mid) to node[weights] {$1$} (v.mid) to node[weights, swap] {$1$} (1);
    \draw[line] (v.mid) to node[weights] {$3$} (2);
    \draw[line] (v.mid) to node[weights] {$1$} (3);
    %
    \node[orange] at (v.east) {$2$};
  \end{scope}
  
  %
  % Second decorated tree
  %

  \begin{scope}[shift = {(4.75,-4)}]
    %
    \node (0) at (0,0) {};
    \node (v) at (0,1) {};
    \node[leaf] (1) at (-1,2) {$1$};
    \node[leaf, anchor = south] (2) at (0, 2) {$2$};
    \node[leaf] (3) at (1, 2) {$3$};

    \draw[line] (0.mid) to node[weights] {$1$} (v.mid) to node[weights, swap] {$1$} (1);
    \draw[line] (v.mid) to node[weights] {$3$} (2);
    \draw[line] (v.mid) to node[weights] {$2$} (3);
    %
    \node[orange] at (v.east) {$0$};
  \end{scope}

  \draw[arrowline] (0.5,2) to node[above] {\normalsize $\hat{\rho}^* \left( \hat{\tau}(\hat{\tree}, i, \tildei), \tildei \right)$} (2.5,2);
  \draw[arrowline] (-2,0.5) to node[auto] {\normalsize $\hat{\pi}_{[3]}^{\bullet 8}$} (-2, -1.5);
  \draw[arrowline] (4.75,0.5) to node[auto] {\normalsize $\hat{\pi}_{[3]}^{\bullet 7}$} (4.75, -1.5);
\end{tikzpicture}
